See the implementation of partitioned_n in algorithms.hpp.